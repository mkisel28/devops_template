#!/bin/bash

# ===========================================
# –°–ü–†–ê–í–ö–ê –ü–û –°–ò–°–¢–ï–ú–ï –ë–ï–ö–ê–ü–û–í
# ===========================================

cat << 'EOF'
üõ†Ô∏è  –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –ë–ï–ö–ê–ü–û–í
====================================

üìñ –û–ü–ò–°–ê–ù–ò–ï:
  –ú–æ–¥—É–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–µ–∫–∞–ø–æ–≤ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö PostgreSQL –∏ Docker volumes
  —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Telegram.

üöÄ –û–°–ù–û–í–ù–´–ï –ö–û–ú–ê–ù–î–´:

  backup                    - –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω—ã–π –±–µ–∫–∞–ø (–ë–î + volumes)
  test-connection          - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
  cleanup                  - –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –±–µ–∫–∞–ø—ã
  restore                  - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±–µ–∫–∞–ø–∞
  schedule                 - –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
  help                     - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É

üîß –û–ü–¶–ò–ò –ö–û–ú–ê–ù–î–´ BACKUP:

  --dry-run               - –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (–Ω–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)
  --volumes-only          - –°–æ–∑–¥–∞—Ç—å –±–µ–∫–∞–ø —Ç–æ–ª—å–∫–æ volumes
  --database-only         - –°–æ–∑–¥–∞—Ç—å –±–µ–∫–∞–ø —Ç–æ–ª—å–∫–æ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
  --no-remote            - –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä

üìã –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø:

  # –ü–æ–ª–Ω—ã–π –±–µ–∫–∞–ø –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
  docker exec backup-container /app/scripts/entrypoint.sh backup --dry-run

  # –ë–µ–∫–∞–ø —Ç–æ–ª—å–∫–æ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
  docker exec backup-container /app/scripts/entrypoint.sh backup --database-only

  # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
  docker exec backup-container /app/scripts/entrypoint.sh test-connection

  # –ë–µ–∫–∞–ø —Ç–æ–ª—å–∫–æ volumes –±–µ–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
  docker exec backup-container /app/scripts/entrypoint.sh backup --volumes-only --no-remote

‚öôÔ∏è  –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø:

  –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: /app/config/backup.env
  
  –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
  - PROJECT_NAME           - –ò–º—è –ø—Ä–æ–µ–∫—Ç–∞
  - BACKUP_VOLUMES         - –í–∫–ª—é—á–∏—Ç—å –±–µ–∫–∞–ø volumes (true/false)
  - BACKUP_DATABASE        - –í–∫–ª—é—á–∏—Ç—å –±–µ–∫–∞–ø –ë–î (true/false)
  - REMOTE_ENABLED         - –í–∫–ª—é—á–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
  - TELEGRAM_ENABLED       - –í–∫–ª—é—á–∏—Ç—å Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  - DRY_RUN               - –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

üìÇ –°–¢–†–£–ö–¢–£–†–ê –î–ò–†–ï–ö–¢–û–†–ò–ô:

  /backup/temp/           - –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
  /backup/archives/       - –õ–æ–∫–∞–ª—å–Ω—ã–µ –∞—Ä—Ö–∏–≤—ã
  /app/logs/             - –§–∞–π–ª—ã –ª–æ–≥–æ–≤
  /app/config/           - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
  /app/scripts/          - –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

üîê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨:

  ‚Ä¢ SSH –∫–ª—é—á–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —É–¥–∞–ª–µ–Ω–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä—É
  ‚Ä¢ –ò–∑–æ–ª—è—Ü–∏—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
  ‚Ä¢ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
  ‚Ä¢ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

üì± TELEGRAM –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø:

  –î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
  1. –°–æ–∑–¥–∞–π—Ç–µ Telegram –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather
  2. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
  3. –£–∑–Ω–∞–π—Ç–µ –≤–∞—à chat_id (–æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —á–µ—Ä–µ–∑ API)
  4. –£–∫–∞–∂–∏—Ç–µ TELEGRAM_BOT_TOKEN –∏ TELEGRAM_CHAT_ID –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

üîÑ –ê–í–¢–û–ú–ê–¢–ò–ó–ê–¶–ò–Ø:

  –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –±–µ–∫–∞–ø–æ–≤ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ cron:
  
  # –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 2:00
  0 2 * * * docker exec backup-container /app/scripts/entrypoint.sh backup

  # –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
  0 1 * * 0 docker exec backup-container /app/scripts/entrypoint.sh test-connection

üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì:

  ‚Ä¢ –õ–æ–≥–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ /app/logs/backup.log
  ‚Ä¢ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–π
  ‚Ä¢ –í–æ–∑–≤—Ä–∞—Ç –∫–æ–¥–æ–≤ –æ—à–∏–±–æ–∫ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º

üÜò –£–°–¢–†–ê–ù–ï–ù–ò–ï –ù–ï–ò–°–ü–†–ê–í–ù–û–°–¢–ï–ô:

  1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é: show-config
  2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: test-connection
  3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏: LOG_LEVEL=DEBUG
  4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: /app/logs/backup.log

üìß –ü–û–î–î–ï–†–ñ–ö–ê:

  –ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
  1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã
  2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
  3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç–µ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
  4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ volumes –∏ —É–¥–∞–ª–µ–Ω–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä—É

EOF
